<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Simple Mobile Invoice App</title>

  <style>
    :root{
      --accent:#0366d6;
      --muted:#666;
      --card:#fff;
      --bg:#f3f6fb;
    }
    *{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
    body{margin:0;background:var(--bg);padding:14px;color:#111}
    .app{max-width:920px;margin:8px auto}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:12px}
    .brand h1{margin:0;font-size:20px}
    .brand small{color:var(--muted)}
    .card{background:var(--card);padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(12,20,30,0.06);margin-bottom:12px}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .col{flex:1;min-width:150px}
    label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
    input{padding:8px;border-radius:8px;border:1px solid #e3e7ee;width:100%;font-size:14px}
    button{cursor:pointer}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{padding:8px;border-bottom:1px solid #eee;text-align:left}
    th{background:#fafafa;font-weight:600;font-size:13px}
    .btn{background:var(--accent);color:#fff;border:none;padding:10px 12px;border-radius:8px;font-size:14px}
    .btn.small{padding:6px 10px;font-size:13px}
    .btn.secondary{background:#2d2d2d}
    .right{text-align:right}
    .remove-btn{background:transparent;border:none;color:#d33;font-size:18px}
  </style>
</head>

<body>
<div class="app">

  <header>
    <div class="brand">
      <h1 contenteditable id="businessName">My Business</h1>
      <small class="muted">Mobile Billing • Offline • Print / PDF</small>
    </div>

    <div class="muted right">
      <div>Invoice # <strong id="invoiceNo"></strong></div>
      <div id="date"></div>
    </div>
  </header>

  <div class="card">
    <div class="row">
      <div class="col">
        <label>Customer Name</label>
        <input id="custName" placeholder="Customer ka naam">
      </div>
      <div class="col">
        <label>Phone</label>
        <input id="custPhone" placeholder="Phone number">
      </div>
      <div class="col">
        <label>GST (%)</label>
        <input id="gstRate" type="number" value="0">
      </div>
      <div class="col">
        <label>Discount (₹)</label>
        <input id="discount" type="number" value="0">
      </div>
    </div>
  </div>

  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong>Items</strong>
      <div style="display:flex;gap:6px">
        <button class="btn small" id="addRow">+ Add Item</button>
        <button class="btn small secondary" id="clearAll">Clear All</button>
      </div>
    </div>

    <table id="itemsTable">
      <thead>
        <tr>
          <th>Item</th>
          <th>Qty</th>
          <th>Rate (₹)</th>
          <th>Total (₹)</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="itemsBody"></tbody>
    </table>

    <div class="card" style="margin-top:12px">
      <div class="row">
        <div class="col muted">Subtotal</div>
        <div class="col right" id="subtotal">₹0.00</div>
      </div>
      <div class="row">
        <div class="col muted">GST (<span id="gstPercentText">0</span>%)</div>
        <div class="col right" id="gstAmount">₹0.00</div>
      </div>
      <div class="row">
        <div class="col muted">Discount</div>
        <div class="col right" id="discountAmount">₹0.00</div>
      </div>
      <hr>
      <div class="row">
        <div class="col"><strong>Grand Total</strong></div>
        <div class="col right"><strong id="grandTotal">₹0.00</strong></div>
      </div>
    </div>

    <div style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap">
      <button class="btn" id="printBtn">Print Invoice</button>
      <button class="btn" id="pdfBtn">Download PDF</button>
    </div>
  </div>

                    </div><!-- JS START -->
<script>

// Currency formatting
function fmt(n){
  n = Number(n) || 0;
  n = Math.round((n + Number.EPSILON) * 100) / 100;
  return n.toFixed(2);
}

// Invoice number + date
const invoiceEl = document.getElementById('invoiceNo');
const dateEl = document.getElementById('date');

function genInvoiceNo(){
  const d = new Date();
  invoiceEl.textContent =
    "INV-" +
    d.getFullYear() +
    String(d.getMonth()+1).padStart(2,'0') +
    String(d.getDate()).padStart(2,'0') +
    "-" +
    String(d.getHours()).padStart(2,'0') +
    String(d.getMinutes()).padStart(2,'0') +
    String(d.getSeconds()).padStart(2,'0');

  dateEl.textContent = d.toLocaleString();
}
genInvoiceNo();

// Elements
const itemsBody = document.getElementById('itemsBody');
const addRowBtn = document.getElementById('addRow');
const clearAllBtn = document.getElementById('clearAll');
const gstInput = document.getElementById('gstRate');
const discountInput = document.getElementById('discount');
const subtotalEl = document.getElementById('subtotal');
const gstAmountEl = document.getElementById('gstAmount');
const discountAmountEl = document.getElementById('discountAmount');
const grandEl = document.getElementById('grandTotal');
const gstPercentText = document.getElementById('gstPercentText');

// Add new row
function newRow(item="", qty=1, rate=0){
  const tr = document.createElement("tr");

  tr.innerHTML = `
    <td><input class="desc" placeholder="Item name"></td>
    <td><input class="qty" type="number" min="0" value="1"></td>
    <td><input class="rate" type="number" min="0" value="0"></td>
    <td class="lineTotal">₹0.00</td>
    <td><button class="remove-btn">✕</button></td>
  `;

  // remove row
  tr.querySelector(".remove-btn").onclick = () => {
    tr.remove();
    calcAll();
  };

  tr.querySelector(".qty").oninput = calcAll;
  tr.querySelector(".rate").oninput = calcAll;

  itemsBody.appendChild(tr);
  calcAll();
}

addRowBtn.onclick = () => newRow();

// Clear all
clearAllBtn.onclick = () => {
  if(confirm("Saare items clear karna hai?")){
    itemsBody.innerHTML = "";
    calcAll();
  }
};

// Total calculation
function calcAll(){
  let subtotal = 0;

  Array.from(itemsBody.querySelectorAll("tr")).forEach(row => {
    let q = Number(row.querySelector(".qty").value) || 0;
    let r = Number(row.querySelector(".rate").value) || 0;

    let line = Math.round((q * r + Number.EPSILON) * 100)/100;
    subtotal += line;

    row.querySelector(".lineTotal").textContent = "₹" + fmt(line);
  });

  let gstRate = Number(gstInput.value) || 0;
  let gstAmount = subtotal * gstRate / 100;

  let discount = Number(discountInput.value) || 0;

  let grand = subtotal + gstAmount - discount;

  subtotalEl.textContent = "₹" + fmt(subtotal);
  gstAmountEl.textContent = "₹" + fmt(gstAmount);
  discountAmountEl.textContent = "₹" + fmt(discount);
  grandEl.textContent = "₹" + fmt(grand);
  gstPercentText.textContent = gstRate;
}

gstInput.oninput = calcAll;
discountInput.oninput = calcAll;

</script><!-- PDF + PRINT SYSTEM -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<script>

// PRINT WINDOW
document.getElementById("printBtn").onclick = () => openPrintWindow();

function openPrintWindow(){
  const business = document.getElementById("businessName").innerText;
  const cust = document.getElementById("custName").value;
  const phone = document.getElementById("custPhone").value;
  const invoice = document.getElementById("invoiceNo").textContent;
  const date = document.getElementById("date").textContent;

  let rows = "";
  Array.from(itemsBody.querySelectorAll("tr")).forEach(r => {
    const desc = r.querySelector(".desc").value;
    const q = r.querySelector(".qty").value;
    const rate = r.querySelector(".rate").value;
    const total = r.querySelector(".lineTotal").textContent;

    rows += `
      <tr>
        <td>${desc}</td>
        <td class="right">${q}</td>
        <td class="right">₹${rate}</td>
        <td class="right">${total}</td>
      </tr>`;
  });

  const html = `
  <html>
  <head>
    <style>
      body{font-family:Arial;padding:20px}
      table{width:100%;border-collapse:collapse;margin-top:12px}
      th,td{padding:8px;border-bottom:1px solid #ddd}
      th{background:#f2f2f2}
      .right{text-align:right}
    </style>
  </head>
  <body>
    <h2>${business}</h2>
    <p>${cust} ${phone ? "• " + phone : ""}</p>
    <p><b>Invoice:</b> ${invoice}<br><b>Date:</b> ${date}</p>

    <table>
      <thead>
        <tr>
          <th>Item</th>
          <th class="right">Qty</th>
          <th class="right">Rate</th>
          <th class="right">Total</th>
        </tr>
      </thead>
      <tbody>${rows}</tbody>
    </table>

    <h3 style="text-align:right;margin-top:20px">
      Grand Total: ${document.getElementById("grandTotal").textContent}
    </h3>
  </body>
  </html>
  `;

  const w = window.open("", "_blank");
  w.document.write(html);
  w.document.close();
  setTimeout(() => w.print(), 500);
}

// PDF DOWNLOAD
document.getElementById("pdfBtn").onclick = async () => {
  const wrapper = document.createElement("div");
  wrapper.style.padding = "20px";
  wrapper.style.background = "#fff";
  wrapper.style.width = "900px";

  wrapper.innerHTML = document.querySelector(".app").innerHTML;
  document.body.appendChild(wrapper);

  const canvas = await html2canvas(wrapper, {scale:2});
  const imgData = canvas.toDataURL("image/png");

  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF("p","pt","a4");
  const wPDF = pdf.internal.pageSize.getWidth();
  const hPDF = pdf.internal.pageSize.getHeight();

  const ratio = Math.min(wPDF / canvas.width, hPDF / canvas.height);
  const wImg = canvas.width * ratio;
  const hImg = canvas.height * ratio;

  pdf.addImage(imgData, "PNG", 10, 10, wImg, hImg);
  pdf.save(document.getElementById("invoiceNo").textContent + ".pdf");

  wrapper.remove();
};

</script>

</body>
</html>
